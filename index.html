<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Note Share</title>

<style>
body{margin:0;background:#f5f6fa;font-family:Arial}
.page{max-width:800px;margin:auto;padding:15px}
.card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.08)}

input,textarea{
  width:100%;
  border:1px solid #ddd;
  border-radius:10px;
  padding:12px;
  font-size:16px;
  outline:none;
}
input:focus,textarea:focus{border-color:#007bff}

textarea{
  min-height:350px;
  resize:none;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:#fff;
  font-size:15px;
}

.note-content a{color:#007bff;word-break:break-all}

/* COMMENT */
.comment-input{
  display:flex;
  gap:10px;
}
.comment-input input{
  flex:1;
  border-radius:20px;
}

.comment{
  display:flex;
  gap:10px;
  margin-top:15px;
}
.avatar{
  width:38px;
  height:38px;
  border-radius:50%;
  background:#007bff;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}
.c-body{
  background:#f0f2f5;
  padding:10px;
  border-radius:12px;
  flex:1;
}
.c-name{font-weight:bold;font-size:14px}
.c-time{font-size:11px;color:#666}
.reply-btn{font-size:12px;color:#007bff;cursor:pointer;margin-top:5px}

.reply-box{
  margin-top:8px;
  display:flex;
  gap:8px;
}
.reply-box input{border-radius:18px}

.reply{
  margin-top:6px;
  font-size:13px;
  color:#333;
}
</style>
</head>
<body>

<div class="page" id="createPage">

  <div class="card" id="accountBox">
    <h3>T·∫°o t√™n hi·ªÉn th·ªã</h3>
    <input id="nameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
    <button onclick="saveName()">L∆∞u</button>
  </div>

  <div class="card">
    <input id="title" placeholder="Ti√™u ƒë·ªÅ note">
    <textarea id="content" placeholder="Nh·∫≠p n·ªôi dung note..."></textarea>
    <button onclick="createLink()">üîó T·∫°o link</button>
  </div>

  <div class="card">
    <h3>Link ƒë√£ t·∫°o</h3>
    <div id="myLinks">Ch∆∞a c√≥</div>
  </div>
</div>

<div class="page" id="viewPage" style="display:none">
  <div class="card">
    <h2 id="viewTitle"></h2>
    <div id="viewContent" class="note-content"></div>
  </div>

  <div class="card">
    <h3>B√¨nh lu·∫≠n</h3>
    <div class="comment-input">
      <input id="commentInput" placeholder="Vi·∫øt b√¨nh lu·∫≠n...">
      <button onclick="addComment()">G·ª≠i</button>
    </div>
    <div id="comments"></div>
  </div>
</div>

<script>
// ===== USER =====
let userId = localStorage.getItem("uid");
if(!userId){
  userId="u"+Date.now();
  localStorage.setItem("uid",userId);
}
let userName = localStorage.getItem("uname");

// ===== ACCOUNT =====
function saveName(){
  const n=nameInput.value.trim();
  if(!n) return alert("Nh·∫≠p t√™n");
  localStorage.setItem("uname",n);
  userName=n;
  accountBox.style.display="none";
}
if(userName) accountBox.style.display="none";

// ===== UTIL =====
function autoLink(t){
  return t.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>').replace(/\n/g,"<br>");
}

const params=new URLSearchParams(location.search);
const id=params.get("id");
const notes=JSON.parse(localStorage.getItem("notes")||"{}");

// ===== VIEW =====
if(id){
  const n=notes[id];
  if(!n) alert("Kh√¥ng t·ªìn t·∫°i");
  else{
    createPage.style.display="none";
    viewPage.style.display="block";
    viewTitle.innerText=n.title;
    viewContent.innerHTML=autoLink(n.content);
    loadComments();
  }
}else renderMyLinks();

// ===== CREATE =====
function createLink(){
  if(!userName) return alert("T·∫°o t√™n tr∆∞·ªõc");
  const t=title.value.trim(),c=content.value.trim();
  if(!t||!c) return alert("Thi·∫øu n·ªôi dung");
  const id="n"+Date.now();
  notes[id]={title:t,content:c,owner:userId,time:new Date().toLocaleString()};
  localStorage.setItem("notes",JSON.stringify(notes));
  const link=location.origin+location.pathname+"?id="+id;
  navigator.clipboard.writeText(link);
  alert("ƒê√£ copy link");
  renderMyLinks();
}

// ===== LINKS =====
function renderMyLinks(){
  const mine=Object.entries(notes).filter(x=>x[1].owner===userId);
  myLinks.innerHTML=mine.length
    ? mine.map((x,i)=>`${i+1}. <a href="?id=${x[0]}">${x[1].title}</a>`).join("<br>")
    : "Ch∆∞a c√≥";
}

// ===== COMMENTS =====
function loadComments(){
  const key="cmt_"+id;
  const data=JSON.parse(localStorage.getItem(key)||"[]");
  comments.innerHTML="";
  data.forEach(c=>{
    comments.innerHTML+=`
    <div class="comment">
      <div class="avatar">${c.name[0]}</div>
      <div class="c-body">
        <div class="c-name">${c.name}</div>
        <div>${c.text}</div>
        <div class="c-time">${c.time}</div>
        ${notes[id].owner===userId?`<div class="reply-btn" onclick="showReply(${c.id})">Tr·∫£ l·ªùi</div>`:""}
        <div id="r${c.id}"></div>
        ${c.reply.map(r=>`<div class="reply">‚Ü≥ ${r}</div>`).join("")}
      </div>
    </div>`;
  });
}

function addComment(){
  if(!userName) return alert("Ch∆∞a c√≥ t√™n");
  const t=commentInput.value.trim();
  if(!t) return;
  const key="cmt_"+id;
  const data=JSON.parse(localStorage.getItem(key)||"[]");
  data.push({id:Date.now(),name:userName,text:t,time:new Date().toLocaleString(),reply:[]});
  localStorage.setItem(key,JSON.stringify(data));
  commentInput.value="";
  loadComments();
}

function showReply(cid){
  document.getElementById("r"+cid).innerHTML=`
    <div class="reply-box">
      <input placeholder="Tr·∫£ l·ªùi..." onkeydown="if(event.key==='Enter')sendReply(${cid},this.value)">
    </div>`;
}

function sendReply(cid,txt){
  if(!txt.trim())return;
  const key="cmt_"+id;
  const data=JSON.parse(localStorage.getItem(key)||"[]");
  data.find(x=>x.id===cid).reply.push(txt);
  localStorage.setItem(key,JSON.stringify(data));
  loadComments();
}
</script>

</body>
</html>