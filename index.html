<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Note Share</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f5f6fa;
  color:#000;
}

.page{max-width:800px;margin:auto;padding:15px}

.card{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

input,textarea,button{
  width:100%;
  margin:6px 0;
  padding:12px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:16px;
}

textarea{
  min-height:300px;
  resize:none;
}

button{
  background:#007bff;
  color:#fff;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

button:hover{opacity:.9}

.note-content{
  background:#f7f7f7;
  padding:15px;
  border-radius:10px;
  white-space:pre-wrap;
}

.note-content a{
  color:#007bff;
  word-break:break-all;
}

.small{font-size:12px;color:#777}

/* SUPPORT BUTTON */
.help-btn{
  display:block;
  margin-top:15px;
  padding:14px;
  text-align:center;
  background:#ff4757;
  color:#fff;
  border-radius:10px;
  font-weight:bold;
  text-decoration:none;
}
.help-btn:hover{opacity:.9}
</style>
</head>

<body>

<div class="page" id="createPage">

  <!-- T√ÄI KHO·∫¢N -->
  <div class="card" id="accountBox">
    <h3>T√™n hi·ªÉn th·ªã</h3>
    <input id="nameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
    <button onclick="saveName()">L∆∞u</button>
  </div>

  <!-- T·∫†O NOTE -->
  <div class="card">
    <input id="title" placeholder="Ti√™u ƒë·ªÅ note">
    <textarea id="content" placeholder="Nh·∫≠p n·ªôi dung (d√°n link tho·∫£i m√°i)"></textarea>

    <!-- LINK H·ªñ TR·ª¢ -->
    <input id="supportLink" placeholder="Link h·ªó tr·ª£ (Zalo / TikTok / Facebook‚Ä¶)">

    <button onclick="createLink()">üîó T·∫°o link</button>
  </div>

  <!-- LINK ƒê√É T·∫†O -->
  <div class="card">
    <h3>Link ƒë√£ t·∫°o</h3>
    <div id="myLinks" class="small">Ch∆∞a c√≥</div>
  </div>

</div>

<!-- VIEW -->
<div class="page" id="viewPage" style="display:none">

  <div class="card">
    <h2 id="viewTitle"></h2>
    <div id="viewContent" class="note-content"></div>

    <a id="helpBtn" class="help-btn" target="_blank">
      ‚ùó C√≥ l·ªói / Link l·ªói ‚Äì Nh·∫•n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£
    </a>
  </div>

</div>

<script>
// ===== USER =====
let userName = localStorage.getItem("uname");
if(!userName){
  userName = "t√©o admin";
  localStorage.setItem("uname", userName);
}
if(userName) accountBox.style.display="none";

function saveName(){
  const n=nameInput.value.trim();
  if(!n) return alert("Nh·∫≠p t√™n");
  localStorage.setItem("uname",n);
  userName=n;
  accountBox.style.display="none";
}

// ===== UTIL =====
function autoLink(t){
  return t.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>');
}

// ===== PARAM =====
const params=new URLSearchParams(location.search);
const data=params.get("data");

// ===== LIST =====
const myNotes=JSON.parse(localStorage.getItem("myNotes")||"[]");

// ===== VIEW NOTE =====
if(data){
  const note=JSON.parse(decodeURIComponent(escape(atob(data))));
  createPage.style.display="none";
  viewPage.style.display="block";

  viewTitle.innerHTML=`
    ${note.title}
    <div class="small">‚úç ${note.owner}</div>
  `;
  viewContent.innerHTML=autoLink(note.content);

  if(note.support){
    helpBtn.href = note.support;
    helpBtn.style.display="block";
  }else{
    helpBtn.style.display="none";
  }

}else{
  renderMyLinks();
}

// ===== CREATE LINK =====
function createLink(){
  if(!userName) return alert("Ch∆∞a c√≥ t√™n");

  const t=title.value.trim();
  const c=content.value.trim();
  const s=supportLink.value.trim();

  if(!t||!c) return alert("Thi·∫øu n·ªôi dung");

  const note={
    title:t,
    content:c,
    owner:userName,
    support:s
  };

  const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(note))));
  const link=location.origin+location.pathname+"?data="+encoded;

  myNotes.push({title:t,link});
  localStorage.setItem("myNotes",JSON.stringify(myNotes));

  navigator.clipboard.writeText(link);
  alert("ƒê√£ copy link üìã");
  renderMyLinks();
}

// ===== LINKS =====
function renderMyLinks(){
  if(!myNotes.length){
    myLinks.innerText="Ch∆∞a c√≥";
    return;
  }
  myLinks.innerHTML=myNotes.map((n,i)=>`
    ${i+1}. <a href="${n.link}">${n.title}</a>
  `).join("<br>");
}
</script>

</body>
</html>