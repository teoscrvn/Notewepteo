<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Note Share - HoÃ n thiá»‡n</title>

<script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f5f6fa;
  color:#000;
}

.page{max-width:800px;margin:auto;padding:15px}

.card{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

input,textarea,button{
  width:100%;
  margin:6px 0;
  padding:12px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:16px;
}

textarea{
  min-height:300px;
  resize:vertical;
}

button{
  background:#007bff;
  color:#fff;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

button:hover{opacity:.9}

.note-content{
  background:#f7f7f7;
  padding:15px;
  border-radius:10px;
  white-space:pre-wrap;
  word-wrap:break-word;
}

.note-content a{
  color:#007bff;
  word-break:break-all;
}

.small{font-size:12px;color:#777}

.help-btn{
  display:block;
  margin-top:15px;
  padding:14px;
  text-align:center;
  background:#ff4757;
  color:#fff;
  border-radius:10px;
  font-weight:bold;
  text-decoration:none;
}
.help-btn:hover{opacity:.9}

.notification {
  position:fixed;
  top:20px;
  right:20px;
  padding:15px 25px;
  border-radius:8px;
  color:white;
  font-weight:bold;
  z-index:1000;
  display:none;
  box-shadow:0 4px 12px rgba(0,0,0,.2);
}

.success { background:#28a745; }
.warning { background:#ffc107; color:#000; }
.error { background:#dc3545; }

.progress-container {
  width:100%;
  background:#e9ecef;
  border-radius:10px;
  margin:10px 0;
  overflow:hidden;
}

.progress-bar {
  height:6px;
  background:#007bff;
  border-radius:10px;
  width:0%;
  transition:width 0.3s;
}

.btn-group {
  display:flex;
  gap:8px;
  margin-top:10px;
}

.btn-group button {
  flex:1;
  font-size:14px;
  padding:10px;
}

.copy-btn { background:#28a745; }
.shorten-btn { background:#6f42c1; }
.text-btn { background:#17a2b8; }
.delete-btn { background:#dc3545; }

.url-warning {
  color:#dc3545;
  font-size:14px;
  margin-top:5px;
  display:none;
}
</style>
</head>

<body>

<div id="notification" class="notification"></div>

<div class="page" id="createPage">
  <div class="card" id="accountBox">
    <h3>ğŸ‘¤ TÃªn hiá»ƒn thá»‹</h3>
    <input id="nameInput" placeholder="Nháº­p tÃªn cá»§a báº¡n">
    <button onclick="saveName()">ğŸ’¾ LÆ°u tÃªn</button>
  </div>

  <div class="card">
    <h3>ğŸ“ Táº¡o note má»›i <span style="font-size:14px;color:#28a745">(Tá»± Ä‘á»™ng nÃ©n LZ-String)</span></h3>
    
    <div style="display:flex; justify-content:space-between; background:#e9ecef; padding:10px; border-radius:8px; margin-bottom:10px; font-size:14px;">
      <div>TiÃªu Ä‘á»: <span id="titleCount">0</span>/100</div>
      <div>Ná»™i dung: <span id="contentCount">0</span> kÃ½ tá»±</div>
      <div>URL dá»± tÃ­nh: <span id="urlEstimate">0</span> kÃ½ tá»±</div>
    </div>
    
    <div class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>
    
    <!-- Cáº¢NH BÃO URL DÃ€I CHO ZALO/FB -->
    <div id="urlWarning" class="url-warning">
      âš ï¸ Link dÃ i â€“ nÃªn dÃ¹ng "Copy as Text" khi chia sáº» trÃªn Zalo/Facebook
    </div>
    
    <input id="title" placeholder="TiÃªu Ä‘á» note (tá»‘i Ä‘a 100 kÃ½ tá»±)" maxlength="100">
    <textarea id="content" placeholder="Nháº­p ná»™i dung... (tá»± Ä‘á»™ng nÃ©n Ä‘á»ƒ URL ngáº¯n)"></textarea>
    <input id="supportLink" placeholder="ğŸ”— Link há»— trá»£ (khÃ´ng báº¯t buá»™c)">
    
    <div class="btn-group">
      <button onclick="createLink()" class="copy-btn">ğŸš€ Táº¡o & Copy Link</button>
      <button onclick="copyAsPlainText()" class="text-btn" id="plainTextBtn" style="display:none;">ğŸ“ Copy as Text</button>
    </div>
    
    <div style="text-align:center; margin-top:10px; font-size:14px; color:#666;">
      <div>âœ… Tá»± Ä‘á»™ng nÃ©n LZ-String (giáº£m 30-60%)</div>
      <div>âœ… Link chia sáº» Ä‘Æ°á»£c cho má»i ngÆ°á»i</div>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ“š Note Ä‘Ã£ táº¡o 
      <button onclick="clearHistory()" style="background:#6c757d; padding:5px 10px; font-size:12px; float:right;">
        XÃ³a lá»‹ch sá»­
      </button>
    </h3>
    <div id="myLinks" class="small">ChÆ°a cÃ³ note nÃ o</div>
  </div>
</div>

<div class="page" id="viewPage" style="display:none">
  <div class="card">
    <h2 id="viewTitle"></h2>
    <div id="viewMeta" class="small"></div>
    <div id="viewContent" class="note-content"></div>
    <a id="helpBtn" class="help-btn" target="_blank">
      ğŸ†˜ CÃ³ lá»—i / Link há»— trá»£ â€“ Nháº¥n Ä‘á»ƒ Ä‘Æ°á»£c giÃºp Ä‘á»¡
    </a>
    
    <div class="btn-group">
      <button onclick="copyCurrentLink()" class="copy-btn">ğŸ“‹ Copy Link</button>
      <button onclick="copyCurrentAsPlainText()" class="text-btn">ğŸ“ Copy as Text</button>
      <button onclick="shortenCurrentLink()" class="shorten-btn">ğŸ”— RÃºt gá»n link</button>
    </div>
    
    <div style="text-align:center; margin-top:20px;">
      <button onclick="window.location.href='?'" style="background:#6c757d; padding:10px 20px;">
        â† Táº¡o note má»›i
      </button>
    </div>
  </div>
</div>

<script>
// ===== Cáº¤U HÃŒNH =====
const MAX_URL_LENGTH = 2000;
const ZALO_SAFE_LENGTH = 1200; // Zalo/FB cÃ³ thá»ƒ cáº¯t tá»« ~1200-1500
const NOTES_HISTORY = "noteShare_history";
let userName = localStorage.getItem("uname") || "";
let notesHistory = JSON.parse(localStorage.getItem(NOTES_HISTORY) || "[]");
let currentNoteData = null;
let currentEncodedData = "";

// ===== KHá»I Äá»˜NG =====
document.addEventListener('DOMContentLoaded', function() {
  if (userName) {
    accountBox.style.display = "none";
    nameInput.value = userName;
  }
  
  title.addEventListener('input', updateStats);
  content.addEventListener('input', updateStats);
  
  const params = new URLSearchParams(location.search);
  const data = params.get("data");
  
  if (data) {
    currentEncodedData = data;
    loadNoteFromURL(data);
  } else {
    renderHistory();
  }
});

// ===== Cáº¬P NHáº¬T THá»NG KÃŠ =====
function updateStats() {
  const titleText = title.value;
  const contentText = content.value;
  
  titleCount.textContent = titleText.length;
  contentCount.textContent = contentText.length;
  
  const plainTextBtn = document.getElementById('plainTextBtn');
  if (titleText || contentText) {
    plainTextBtn.style.display = 'block';
  } else {
    plainTextBtn.style.display = 'none';
  }
  
  const note = {
    title: titleText,
    content: contentText,
    owner: userName || "áº¨n danh",
    support: document.getElementById('supportLink').value,
    created: Date.now(),
    version: "2.0",
    encoder: "lz-string"
  };
  
  try {
    const jsonStr = JSON.stringify(note);
    const compressed = LZString.compressToEncodedURIComponent(jsonStr);
    const base = location.href.split("?")[0];
    const estimatedURL = base + "?data=" + compressed;
    const urlLength = estimatedURL.length;
    
    urlEstimate.textContent = urlLength;
    
    // Cáº¢NH BÃO URL DÃ€I CHO ZALO/FB
    const urlWarning = document.getElementById('urlWarning');
    if (urlLength > ZALO_SAFE_LENGTH) {
      urlWarning.style.display = 'block';
    } else {
      urlWarning.style.display = 'none';
    }
    
    // Progress bar
    const progress = Math.min((urlLength / MAX_URL_LENGTH) * 100, 100);
    progressBar.style.width = progress + '%';
    
    if (urlLength > MAX_URL_LENGTH * 0.9) {
      progressBar.style.background = '#dc3545';
    } else if (urlLength > MAX_URL_LENGTH * 0.7) {
      progressBar.style.background = '#ffc107';
    } else {
      progressBar.style.background = '#28a745';
    }
    
  } catch (e) {
    urlEstimate.textContent = "?";
  }
}

// ===== HÃ€M ESCAPE AN TOÃ€N (FIX Lá»–I 1) =====
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text == null ? '' : text;
  return div.innerHTML;
}

// FIX Lá»–I QUAN TRá»ŒNG 1: Xá»­ lÃ½ null/undefined
function escapeSingleQuotes(text) {
  return String(text || '').replace(/'/g, "\\'");
}

// ===== USER =====
function saveName() {
  const n = nameInput.value.trim();
  if (!n) {
    showNotification("Vui lÃ²ng nháº­p tÃªn!", "error");
    return;
  }
  localStorage.setItem("uname", n);
  userName = n;
  accountBox.style.display = "none";
  showNotification(`ÄÃ£ lÆ°u tÃªn: ${n}`, "success");
  updateStats();
}

// ===== Táº O LINK =====
function createLink() {
  if (!userName) {
    showNotification("Vui lÃ²ng nháº­p tÃªn trÆ°á»›c!", "error");
    accountBox.style.display = "block";
    return;
  }

  const t = title.value.trim();
  const c = content.value.trim();
  const s = supportLink.value.trim();

  if (!t || !c) {
    showNotification("Vui lÃ²ng nháº­p tiÃªu Ä‘á» vÃ  ná»™i dung!", "error");
    return;
  }

  const note = {
    title: t,
    content: c,
    owner: userName,
    support: s,
    created: Date.now(),
    version: "2.0",
    encoder: "lz-string"
  };

  try {
    const jsonStr = JSON.stringify(note);
    const compressed = LZString.compressToEncodedURIComponent(jsonStr);
    
    if (!compressed) throw new Error("Lá»—i nÃ©n dá»¯ liá»‡u");
    
    const base = location.href.split("?")[0].split("#")[0];
    const link = base + "?data=" + compressed;
    const urlLength = link.length;
    
    if (urlLength > MAX_URL_LENGTH) {
      if (!confirm(`âš ï¸ URL dÃ i ${urlLength} kÃ½ tá»± (giá»›i háº¡n: ${MAX_URL_LENGTH})!\n\nTiáº¿p tá»¥c?`)) return;
    }
    
    notesHistory.unshift({
      title: t,
      link: link,
      data: compressed,
      urlLength: urlLength,
      time: new Date().toLocaleString('vi-VN'),
      encoder: "lz-string"
    });
    
    if (notesHistory.length > 50) {
      notesHistory = notesHistory.slice(0, 50);
    }
    
    localStorage.setItem(NOTES_HISTORY, JSON.stringify(notesHistory));
    
    copyToClipboard(link, `âœ… ÄÃ£ táº¡o vÃ  copy link!\n\nğŸ“ Äá»™ dÃ i: ${urlLength} kÃ½ tá»±`);
    
    resetForm();
    renderHistory();
    
  } catch (error) {
    console.error("Lá»—i táº¡o link:", error);
    showNotification("Lá»—i khi táº¡o link!", "error");
  }
}

// ===== Táº¢I NOTE =====
function loadNoteFromURL(data) {
  try {
    let decoded = null;
    let note = null;
    
    decoded = LZString.decompressFromEncodedURIComponent(data);
    if (decoded) {
      note = JSON.parse(decoded);
    } else {
      try {
        decoded = decodeURIComponent(atob(data));
        note = JSON.parse(decoded);
      } catch {
        decoded = atob(data);
        note = JSON.parse(decoded);
      }
    }
    
    currentNoteData = note;
    
    createPage.style.display = "none";
    viewPage.style.display = "block";
    
    viewTitle.textContent = note.title || "KhÃ´ng tiÃªu Ä‘á»";
    
    const createdDate = new Date(note.created || Date.now());
    viewMeta.innerHTML = `
      ğŸ‘¤ <strong>${note.owner || "áº¨n danh"}</strong> | 
      ğŸ“… ${createdDate.toLocaleDateString('vi-VN')}
    `;
    
    let content = note.content || '';
    content = content
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
    
    const urlRegex = /(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/gi;
    content = content.replace(urlRegex, function(match) {
      const cleanUrl = match
        .replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#039;/g, "'");
      return `<a href="${cleanUrl}" target="_blank" rel="noopener">${match}</a>`;
    });
    
    content = content.replace(/\n/g, '<br>');
    viewContent.innerHTML = content;
    
    if (note.support && note.support.trim()) {
      let supportLink = note.support.trim();
      if (!supportLink.startsWith('http')) {
        supportLink = 'https://' + supportLink;
      }
      helpBtn.href = supportLink;
      helpBtn.style.display = "block";
    } else {
      helpBtn.style.display = "none";
    }
    
    addToViewHistory(note.title, data);
    
  } catch (error) {
    console.error("Lá»—i táº£i note:", error);
    createPage.style.display = "none";
    viewPage.style.display = "block";
    viewTitle.textContent = "âŒ Lá»—i";
    viewContent.innerHTML = `
      <div style="text-align:center; padding:40px; color:#666">
        <h3>KhÃ´ng thá»ƒ táº£i note</h3>
        <button onclick="window.location.href='?'" style="margin-top:20px; padding:10px 20px;">
          â† Táº¡o note má»›i
        </button>
      </div>
    `;
  }
}

// ===== COPY Dáº NG TEXT =====
function copyAsPlainText() {
  const t = title.value.trim();
  const c = content.value.trim();
  const s = supportLink.value.trim();
  
  if (!t || !c) {
    showNotification("Vui lÃ²ng nháº­p ná»™i dung trÆ°á»›c!", "error");
    return;
  }
  
  const note = {
    title: t,
    content: c,
    owner: userName || "áº¨n danh",
    support: s,
    created: Date.now(),
    version: "2.0",
    encoder: "lz-string"
  };
  
  try {
    const jsonStr = JSON.stringify(note);
    const compressed = LZString.compressToEncodedURIComponent(jsonStr);
    const base = location.href.split("?")[0];
    const link = base + "?data=" + compressed;
    
    const textToCopy = `ğŸ“ ${t}\n\n${c}\n\nğŸ”— Link: ${link}`;
    
    copyToClipboard(textToCopy, "âœ… ÄÃ£ copy dáº¡ng text!\n\nğŸ“‹ DÃ¡n vÃ o chat trÆ°á»›c khi gá»­i Ä‘á»ƒ trÃ¡nh bá»‹ cáº¯t link.");
    
  } catch (error) {
    showNotification("Lá»—i táº¡o link!", "error");
  }
}

function copyCurrentAsPlainText() {
  if (!currentNoteData) {
    showNotification("KhÃ´ng cÃ³ dá»¯ liá»‡u note!", "error");
    return;
  }
  
  const base = location.href.split("?")[0];
  const link = base + "?data=" + currentEncodedData;
  const textToCopy = `ğŸ“ ${currentNoteData.title || "KhÃ´ng tiÃªu Ä‘á»"}\n\n${currentNoteData.content || ""}\n\nğŸ”— Link: ${link}`;
  
  copyToClipboard(textToCopy, "âœ… ÄÃ£ copy dáº¡ng text!\n\nğŸ“‹ DÃ¡n vÃ o chat trÆ°á»›c khi gá»­i Ä‘á»ƒ trÃ¡nh preview cáº¯t link.");
}

// ===== RÃšT Gá»ŒN LINK =====
async function shortenCurrentLink() {
  if (!currentEncodedData) return;
  
  const base = location.href.split("?")[0];
  const longUrl = base + "?data=" + currentEncodedData;
  
  await shortenUrlSafe(longUrl);
}

async function shortenUrlSafe(longUrl) {
  try {
    showNotification("â³ Äang rÃºt gá»n link...", "warning");
    
    // Fallback Ä‘Æ¡n giáº£n: náº¿u TinyURL lá»—i, dÃ¹ng is.gd
    let shortUrl = await tryTinyURL(longUrl);
    if (!shortUrl) {
      shortUrl = await tryIsgd(longUrl);
    }
    
    if (shortUrl) {
      copyToClipboard(shortUrl, `âœ… ÄÃ£ rÃºt gá»n vÃ  copy!\n\nğŸ”— ${shortUrl}`);
    } else {
      throw new Error("KhÃ´ng rÃºt gá»n Ä‘Æ°á»£c");
    }
    
  } catch (error) {
    console.error("Lá»—i rÃºt gá»n link:", error);
    showNotification("âŒ KhÃ´ng thá»ƒ rÃºt gá»n. ÄÃ£ copy link gá»‘c.", "error");
    copyToClipboard(longUrl);
  }
}

async function tryTinyURL(longUrl) {
  try {
    const proxyUrl = 'https://corsproxy.io/?';
    const tinyUrlApi = `https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`;
    const response = await fetch(proxyUrl + encodeURIComponent(tinyUrlApi), { timeout: 5000 });
    
    if (response.ok) {
      const text = await response.text();
      if (text.includes("http")) return text;
    }
  } catch (e) {
    console.log("TinyURL failed, trying alternative...");
  }
  return null;
}

async function tryIsgd(longUrl) {
  try {
    const response = await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(longUrl)}`, { timeout: 5000 });
    if (response.ok) {
      const text = await response.text();
      if (text.includes("http")) return text;
    }
  } catch (e) {
    console.log("is.gd failed");
  }
  return null;
}

// ===== TIá»†N ÃCH =====
function copyToClipboard(text, message) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      if (message) showNotification(message, "success");
    }).catch(() => {
      copyFallback(text, message);
    });
  } else {
    copyFallback(text, message);
  }
}

function copyFallback(text, message) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  textarea.style.position = 'fixed';
  textarea.style.left = '-999999px';
  textarea.style.top = '-999999px';
  document.body.appendChild(textarea);
  textarea.focus();
  textarea.select();
  
  try {
    document.execCommand('copy');
    if (message) showNotification(message, "success");
  } catch (err) {
    prompt("Vui lÃ²ng copy thá»§ cÃ´ng:", text);
  }
  
  document.body.removeChild(textarea);
}

function showNotification(message, type = "info") {
  const notif = document.getElementById('notification');
  notif.innerHTML = message;
  notif.className = `notification ${type}`;
  notif.style.display = 'block';
  
  setTimeout(() => {
    notif.style.display = 'none';
  }, 5000);
}

function resetForm() {
  title.value = '';
  content.value = '';
  supportLink.value = '';
  updateStats();
}

function addToViewHistory(title, data) {
  const viewHistory = JSON.parse(localStorage.getItem('noteShare_viewHistory') || "[]");
  viewHistory.unshift({
    title: title || 'KhÃ´ng tiÃªu Ä‘á»',
    time: new Date().toISOString()
  });
  if (viewHistory.length > 20) viewHistory.length = 20;
  localStorage.setItem('noteShare_viewHistory', JSON.stringify(viewHistory));
}

// ===== RENDER HISTORY (FIX Lá»–I 2) =====
function renderHistory() {
  if (!notesHistory || notesHistory.length === 0) {
    myLinks.innerHTML = '<p style="color:#666; text-align:center">ChÆ°a cÃ³ note nÃ o</p>';
    return;
  }
  
  myLinks.innerHTML = notesHistory.map((note, index) => {
    const safeLink = encodeURIComponent(note.link || '');
    const safeData = encodeURIComponent(note.data || '');
    
    return `
    <div style="margin:10px 0; padding:12px; background:#f8f9fa; border-radius:8px; border-left:4px solid ${note.urlLength > MAX_URL_LENGTH ? '#dc3545' : '#28a745'}">
      <div style="display:flex; justify-content:space-between; align-items:flex-start;">
        <div>
          <strong>${index + 1}. ${escapeHtml(note.title || 'KhÃ´ng tiÃªu Ä‘á»')}</strong>
          <div style="font-size:11px; color:#666; margin-top:3px;">
            ğŸ•’ ${escapeHtml(note.time || '')} | ğŸ“ ${note.urlLength || 0} kÃ½ tá»±
          </div>
        </div>
        <div style="display:flex; gap:5px;">
          <button onclick="copyToClipboard('${escapeSingleQuotes(note.link)}', 'âœ… ÄÃ£ copy link!')" 
                  style="background:#28a745; padding:5px 10px; font-size:12px;"
                  title="Copy link">
            ğŸ“‹
          </button>
          <button onclick="shortenUrlSafe(decodeURIComponent('${safeLink}'))"
                  style="background:#6f42c1; padding:5px 10px; font-size:12px;"
                  title="RÃºt gá»n link">
            ğŸ”—
          </button>
          <button onclick="copyNoteAsText('${safeData}')"
                  style="background:#17a2b8; padding:5px 10px; font-size:12px;"
                  title="Copy dáº¡ng text (cÃ³ ná»™i dung)">
            ğŸ“
          </button>
          <button onclick="deleteNote(${index})"
                  style="background:#dc3545; padding:5px 10px; font-size:12px;"
                  title="XÃ³a">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
      <div style="margin-top:8px; word-break:break-all; font-size:12px;">
        <a href="${escapeHtml(note.link)}" target="_blank">${escapeHtml((note.link || '').substring(0, 80))}...</a>
      </div>
    </div>
    `;
  }).join('');
}

// FIX Lá»–I QUAN TRá»ŒNG 2: Copy cáº£ ná»™i dung note
function copyNoteAsText(encodedData) {
  try {
    const data = decodeURIComponent(encodedData);
    const base = location.href.split("?")[0];
    const link = base + "?data=" + data;
    
    let note = null;
    
    // Thá»­ LZ-String trÆ°á»›c
    const decompressed = LZString.decompressFromEncodedURIComponent(data);
    if (decompressed) {
      note = JSON.parse(decompressed);
    } else {
      // Thá»­ base64 (phiÃªn báº£n cÅ©)
      try {
        const decoded = atob(data);
        note = JSON.parse(decoded);
      } catch (e) {
        // Thá»­ base64 vá»›i encodeURIComponent
        try {
          const decoded = decodeURIComponent(atob(data));
          note = JSON.parse(decoded);
        } catch (e2) {
          // KhÃ´ng giáº£i mÃ£ Ä‘Æ°á»£c
        }
      }
    }
    
    let textToCopy;
    if (note && note.content) {
      textToCopy = `ğŸ“ ${note.title || 'KhÃ´ng tiÃªu Ä‘á»'}\n\n${note.content}\n\nğŸ”— Link: ${link}`;
    } else {
      // Fallback náº¿u khÃ´ng láº¥y Ä‘Æ°á»£c ná»™i dung
      const title = note ? note.title : 'Note';
      textToCopy = `ğŸ“ ${title}\n\nğŸ”— Link: ${link}`;
    }
    
    copyToClipboard(textToCopy, "âœ… ÄÃ£ copy dáº¡ng text (cÃ³ ná»™i dung note)!");
    
  } catch (error) {
    console.error("Lá»—i copy note as text:", error);
    showNotification("Lá»—i khi copy ná»™i dung!", "error");
  }
}

function copyCurrentLink() {
  const link = window.location.href;
  copyToClipboard(link, "âœ… ÄÃ£ copy link!");
}

function deleteNote(index) {
  if (!confirm("XÃ³a note nÃ y khá»i lá»‹ch sá»­?")) return;
  
  notesHistory.splice(index, 1);
  localStorage.setItem(NOTES_HISTORY, JSON.stringify(notesHistory));
  renderHistory();
  showNotification("âœ… ÄÃ£ xÃ³a note!", "success");
}

function clearHistory() {
  if (confirm("XÃ³a toÃ n bá»™ lá»‹ch sá»­?\n\nLÆ°u Ã½: Link Ä‘Ã£ chia sáº» váº«n hoáº¡t Ä‘á»™ng.")) {
    notesHistory = [];
    localStorage.removeItem(NOTES_HISTORY);
    renderHistory();
    showNotification("âœ… ÄÃ£ xÃ³a lá»‹ch sá»­!", "success");
  }
}

// ===== KIá»‚M TRA LZ-STRING =====
if (typeof LZString === 'undefined') {
  console.error("LZString chÆ°a load!");
  showNotification("âš ï¸ Lá»—i: ThÆ° viá»‡n nÃ©n chÆ°a load. Vui lÃ²ng reload trang.", "error");
}
</script>
</body>
</html>