<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Note Share</title>

<style>
body{
  margin:0;
  background:#f5f6fa;
  font-family:Arial;
  color:#000;
}
.page{max-width:800px;margin:auto;padding:15px}
.card{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.08)
}
input,textarea{
  width:100%;
  padding:12px;
  border:1px solid #ddd;
  border-radius:10px;
  font-size:16px;
  outline:none;
}
textarea{min-height:320px;resize:none}
button{
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:#fff;
  font-size:15px;
}
.note-content a{color:#007bff;word-break:break-all}

/* COMMENT */
.comment{display:flex;gap:10px;margin-top:15px}
.avatar{
  width:36px;height:36px;border-radius:50%;
  background:#007bff;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:bold
}
.c-body{
  background:#f0f2f5;
  padding:10px;
  border-radius:12px;
  flex:1
}
.c-name{font-weight:bold;font-size:14px}
.c-time{font-size:11px;color:#666}
.reply{margin-left:15px;font-size:13px;color:#333}
.small{font-size:12px;color:#777}
</style>
</head>

<body>

<div class="page" id="createPage">

  <div class="card" id="accountBox">
    <h3>T√™n hi·ªÉn th·ªã</h3>
    <input id="nameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
    <button onclick="saveName()">L∆∞u</button>
  </div>

  <div class="card">
    <input id="title" placeholder="Ti√™u ƒë·ªÅ note">
    <textarea id="content" placeholder="Nh·∫≠p n·ªôi dung (d√°n link tho·∫£i m√°i)"></textarea>
    <button onclick="createLink()">üîó T·∫°o link</button>
  </div>

  <div class="card">
    <h3>Link ƒë√£ t·∫°o</h3>
    <div id="myLinks" class="small">Ch∆∞a c√≥</div>
  </div>

</div>

<div class="page" id="viewPage" style="display:none">

  <div class="card">
    <h2 id="viewTitle"></h2>
    <div id="viewContent" class="note-content"></div>
  </div>

  <div class="card">
    <h3>B√¨nh lu·∫≠n</h3>
    <input id="commentInput" placeholder="Vi·∫øt b√¨nh lu·∫≠n...">
    <button onclick="addComment()">G·ª≠i</button>
    <div id="comments"></div>
  </div>

</div>

<script>
// ===== USER =====
let userName = localStorage.getItem("uname");
if(!userName){
  userName = "t√©o admin";
  localStorage.setItem("uname", userName);
}
if(userName) accountBox.style.display="none";

function saveName(){
  const n=nameInput.value.trim();
  if(!n) return alert("Nh·∫≠p t√™n");
  localStorage.setItem("uname",n);
  userName=n;
  accountBox.style.display="none";
}

// ===== UTIL =====
function autoLink(t){
  return t.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>')
          .replace(/\n/g,"<br>");
}

// ===== PARAM =====
const params=new URLSearchParams(location.search);
const data=params.get("data");

// ===== LOCAL LIST =====
const myNotes=JSON.parse(localStorage.getItem("myNotes")||"[]");

// ===== VIEW SHARE (QUAN TR·ªåNG) =====
if(data){
  const note=JSON.parse(decodeURIComponent(escape(atob(data))));
  createPage.style.display="none";
  viewPage.style.display="block";

  viewTitle.innerHTML=`
    ${note.title}
    <div class="small">‚úç ${note.owner} ¬∑ üïí ${note.time}</div>
  `;
  viewContent.innerHTML=autoLink(note.content);

  window.commentKey="cmt_"+data;
  loadComments();

}else{
  renderMyLinks();
}

// ===== CREATE LINK =====
function createLink(){
  if(!userName) return alert("Ch∆∞a c√≥ t√™n");
  const t=title.value.trim();
  const c=content.value.trim();
  if(!t||!c) return alert("Thi·∫øu n·ªôi dung");

  const note={
    title:t,
    content:c,
    owner:userName,
    time:new Date().toLocaleString()
  };

  const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(note))));
  const link=location.origin+location.pathname+"?data="+encoded;

  myNotes.push({title:t,link,time:note.time});
  localStorage.setItem("myNotes",JSON.stringify(myNotes));

  navigator.clipboard.writeText(link);
  alert("ƒê√£ copy link üìã");
  renderMyLinks();
}

// ===== LIST =====
function renderMyLinks(){
  if(!myNotes.length){
    myLinks.innerText="Ch∆∞a c√≥";
    return;
  }
  myLinks.innerHTML=myNotes.map((n,i)=>`
    ${i+1}. <a href="${n.link}">${n.title}</a>
    <span class="small">(${n.time})</span>
  `).join("<br>");
}

// ===== COMMENTS =====
function loadComments(){
  const data=JSON.parse(localStorage.getItem(window.commentKey)||"[]");
  comments.innerHTML="";
  data.forEach(c=>{
    comments.innerHTML+=`
      <div class="comment">
        <div class="avatar">${c.name[0]}</div>
        <div class="c-body">
          <div class="c-name">${c.name}</div>
          <div>${c.text}</div>
          <div class="c-time">${c.time}</div>
          ${c.reply.map(r=>`<div class="reply">‚Ü≥ ${r}</div>`).join("")}
        </div>
      </div>
    `;
  });
}

function addComment(){
  const t=commentInput.value.trim();
  if(!t) return;
  const data=JSON.parse(localStorage.getItem(window.commentKey)||"[]");
  data.push({
    name:userName,
    text:t,
    time:new Date().toLocaleString(),
    reply:[]
  });
  localStorage.setItem(window.commentKey,JSON.stringify(data));
  commentInput.value="";
  loadComments();
}
</script>

</body>
</html>